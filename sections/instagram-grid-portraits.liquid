{% comment %}
  Shopify Section: Instagram Grid
  Role: Displays multiple Instagram posts in a compact, responsive grid.
{% endcomment %}

<div class="section-instagram-grid container mx-auto py-8 md:py-12 px-4" data-section-id="{{ section.id }}">


  {% if section.blocks.size > 0 %}
    <div class="instagram-grid">

      {% for block in section.blocks %}
        <div class="instagram-post-item" {{ block.shopify_attributes }}>
          <a href="{{ block.settings.post_url }}" target="_blank" rel="noopener noreferrer" class="block">
            {% if block.settings.image != blank %}
              <img src="{{ block.settings.image | img_url: 'master' }}" alt="{{ block.settings.image.alt | escape }}">
            {% else %}
              <div class="bg-gray-200 w-full" style="padding-top: 100%;"></div>
            {% endif %}
          </a>
        </div>
      {% endfor %}

    </div>
  {% else %}
    <div class="text-center">
      <p>Add Instagram posts to this section in the theme editor.</p>
    </div>
  {% endif %}
</div>

<style>
  .section-instagram-grid .instagram-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 5px; /* Minimum 5px gutter */
    justify-content: flex-start; /* Align items to the start */
  }

  .section-instagram-grid .instagram-post-item {
    flex: 0 0 calc(30% - 5px); /* Occupy 30% width, accounting for gap */
  }
  
  .section-instagram-grid .instagram-post-item a {
    display: block;
  }

  .section-instagram-grid .instagram-post-item img {
    width: 100%;
    height: auto;
  }

  @media (max-width: 768px) {
    .section-instagram-grid .instagram-post-item {
      flex: 0 0 calc(48% - 5px); /* Two images per row on mobile */
    }
  }
</style>

{% schema %}
{
  "name": "Portraits Instagram Grid",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Heading",
      "default": "Portraits on Instagram",
      "info": "Heading above the grid."
    }
  ],
  "blocks": [
    {
      "type": "instagram_post",
      "name": "Instagram Post",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "url",
          "id": "post_url",
          "label": "Post URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Portraits Instagram Grid",
      "category": "Social",
      "blocks": [
        { "type": "instagram_post" },
        { "type": "instagram_post" },
        { "type": "instagram_post" },
        { "type": "instagram_post" }
      ]
    }
  ],
  "max_blocks": 24
}
{% endschema %}